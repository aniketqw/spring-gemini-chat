name: Deploy to Hugging Face Space

on:
  push:
    branches:
      - master
  workflow_dispatch:

env:
  HF_USERNAME: aniketqw  # Change this to your actual HF username
  
jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      
    - name: Set up JDK 17
      uses: actions/setup-java@v4
      with:
        java-version: '17'
        distribution: 'temurin'
        
    - name: Build with Maven
      run: mvn clean package -DskipTests
      
    - name: Create Dockerfile
      run: |
        cat > Dockerfile << 'EOF'
        FROM openjdk:17-jdk-slim
        WORKDIR /app
        COPY target/*.jar app.jar
        EXPOSE 7860
        ENV SERVER_PORT=7860
        ENTRYPOINT ["java", "-jar", "/app/app.jar"]
        EOF
        
    - name: Create README.md
      run: |
        cat > README.md << 'EOF'
        ---
        title: Spring Gemini Chat
        emoji: ðŸ¤–
        colorFrom: blue
        colorTo: green
        sdk: docker
        app_port: 7860
        ---
        
        # Spring Gemini Chat
        A Spring Boot application with Google Gemini AI integration.
        EOF
        
    - name: Deploy to Hugging Face Space
      uses: huggingface/push-to-hub-action@main
      with:
        repo-name: ${{ env.HF_USERNAME }}/spring-gemini-chat
        repo-type: space
        hf-token: ${{ secrets.HF_TOKEN }}
